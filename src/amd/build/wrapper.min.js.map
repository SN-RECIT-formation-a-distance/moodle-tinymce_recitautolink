{"version":3,"file":"wrapper.min.js","sources":["../src/wrapper.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n *\r\n * @module      tiny_recitautolink/plugin\r\n * @copyright  2019 RECIT\r\n * @license    {@link http://www.gnu.org/licenses/gpl-3.0.html} GNU GPL v3 or later\r\n */\r\nimport {get_string as getString} from 'core/str';\r\nimport {getCourseId} from './options';\r\nimport Modal from 'core/modal';\r\nimport ModalEvents from 'core/modal_events';\r\n\r\nexport class Editor {\r\n    appReact = null;\r\n    modal = null;\r\n\r\n    async open(editor) {\r\n        this.editor = editor;\r\n        let url = M.cfg.wwwroot;\r\n        let js = url + \"/lib/editor/tiny/plugins/recitautolink/react/build/index.js\";\r\n        let that = this;\r\n\r\n        this.modal = await Modal.create({\r\n            title: getString('pluginname', 'tiny_recitautolink'),\r\n            body: '<div id=\"recitautolink_container\"></div>'\r\n        });\r\n\r\n        this.modal.setRemoveOnClose(true);\r\n        this.modal.getModal().addClass('modal-xl');\r\n\r\n        this.modal.getRoot().on(ModalEvents.hidden, () => {\r\n            that.unmountUI();\r\n            that.modal.destroy();  \r\n        });\r\n\r\n        this.modal.show();\r\n\r\n        if (!document.getElementById('recitautolink')) {\r\n            var script = document.createElement('script');\r\n            script.onload = this.loadUI.bind(this); \r\n            script.setAttribute('src', js); \r\n            script.setAttribute('id', 'recitautolink');\r\n            script.setAttribute('type', 'text/javascript');\r\n            document.getElementsByTagName('head')[0].appendChild(script);\r\n        } else {\r\n            this.loadUI();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get template context.\r\n     *\r\n     * @param {TinyMCE} editor\r\n     * @returns {Object}\r\n     */\r\n    getTemplateContext(editor) {\r\n        return {\r\n            elementid: editor.id\r\n        };\r\n    }\r\n\r\n    get() {\r\n        return getCourseId(this.editor);\r\n    }\r\n\r\n    unmountUI() {\r\n        if (this.appReact) {\r\n            this.appReact.unmount();\r\n        }\r\n    }\r\n\r\n    loadUI() {\r\n        if (window.openRecitAutolinkUI) {\r\n            let classHandler = {\r\n                get: (v) => this.get(v),\r\n                close: (v) => this.closeUI(v)\r\n            };\r\n            this.appReact = window.openRecitAutolinkUI(classHandler);\r\n        }\r\n    }\r\n\r\n    closeUI(code) {\r\n        this.modal.destroy();  \r\n\r\n        this.unmountUI();\r\n        if (code) {\r\n            this.editor.execCommand('mceInsertContent', false, code);\r\n        }\r\n    }\r\n}"],"names":["editor","js","M","cfg","wwwroot","that","this","modal","Modal","create","title","body","setRemoveOnClose","getModal","addClass","getRoot","on","ModalEvents","hidden","unmountUI","destroy","show","document","getElementById","loadUI","script","createElement","onload","bind","setAttribute","getElementsByTagName","appendChild","getTemplateContext","elementid","id","get","appReact","unmount","window","openRecitAutolinkUI","classHandler","v","close","closeUI","code","execCommand"],"mappings":"koBA2Be,mCACH,iBAEGA,aACFA,OAASA,WAEVC,GADMC,EAAEC,IAAIC,QACD,8DACXC,KAAOC,aAENC,YAAcC,eAAMC,OAAO,CAC5BC,OAAO,mBAAU,aAAc,sBAC/BC,KAAM,kDAGLJ,MAAMK,kBAAiB,QACvBL,MAAMM,WAAWC,SAAS,iBAE1BP,MAAMQ,UAAUC,GAAGC,sBAAYC,QAAQ,KACxCb,KAAKc,YACLd,KAAKE,MAAMa,kBAGVb,MAAMc,OAENC,SAASC,eAAe,sBAQpBC,aARsC,KACvCC,OAASH,SAASI,cAAc,UACpCD,OAAOE,OAASrB,KAAKkB,OAAOI,KAAKtB,MACjCmB,OAAOI,aAAa,MAAO5B,IAC3BwB,OAAOI,aAAa,KAAM,iBAC1BJ,OAAOI,aAAa,OAAQ,mBAC5BP,SAASQ,qBAAqB,QAAQ,GAAGC,YAAYN,SAY7DO,mBAAmBhC,cACR,CACHiC,UAAWjC,OAAOkC,IAI1BC,aACW,wBAAY7B,KAAKN,QAG5BmB,YACQb,KAAK8B,eACAA,SAASC,UAItBb,YACQc,OAAOC,oBAAqB,KACxBC,aAAe,CACfL,IAAMM,GAAMnC,KAAK6B,IAAIM,GACrBC,MAAQD,GAAMnC,KAAKqC,QAAQF,SAE1BL,SAAWE,OAAOC,oBAAoBC,eAInDG,QAAQC,WACCrC,MAAMa,eAEND,YACDyB,WACK5C,OAAO6C,YAAY,oBAAoB,EAAOD"}