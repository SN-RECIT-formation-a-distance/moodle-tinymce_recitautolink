{"version":3,"file":"wrapper.min.js","sources":["../src/wrapper.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * @module      tiny_recitautolink/plugin\n * @copyright  2019 RECIT\n * @license    {@link http://www.gnu.org/licenses/gpl-3.0.html} GNU GPL v3 or later\n */\n///import {get_string as getString} from 'core/str';\nimport {getCourseId} from './options';\n\nexport class Editor {\n\n    open(editor){\n        this.editor = editor;\n        var url = M.cfg.wwwroot;\n        var js = url +\"/lib/editor/tiny/plugins/recitautolink/react/build/index.js\";\n        //var css = url +\"/lib/editor/atto/plugins/recitautolink/build/index.css\";\n\n        var content = document.createElement('div');\n        content.setAttribute('id', 'recitautolink_container');\n        this.createPopup(content);\n\n        if (!document.getElementById('recitautolink')){\n            var script = document.createElement('script');\n            script.onload = this.loadUi.bind(this);\n            script.setAttribute('src', js);\n            script.setAttribute('id', 'recitautolink');\n            script.setAttribute('type', 'text/javascript');\n            document.getElementsByTagName('head')[0].appendChild(script);\n            /*script = document.createElement('link');\n            script.setAttribute('href', css);\n            script.setAttribute('rel', 'stylesheet');\n            document.getElementsByTagName('head')[0].appendChild(script);*/\n        }else{\n            this.loadUi();\n        }\n    }\n\n    get(k){\n        return getCourseId(this.editor);\n    }\n\n    createPopup(content) {\n        let modal = document.createElement('div');\n        modal.classList.add('modal', 'fade', 'autolink_popup');\n        modal.setAttribute('style', 'overflow-y: hidden;');\n\n        let inner2 = document.createElement('div');\n        inner2.classList.add('modal-dialog');\n        inner2.classList.add('modal-xl');\n        modal.appendChild(inner2);\n\n        let inner = document.createElement('div');\n        inner.classList.add('modal-content');\n        inner2.appendChild(inner);\n\n        let header = document.createElement('div');\n        header.classList.add('modal-header');\n        header.innerHTML = \"<h2>\"+M.util.get_string('pluginname', 'tiny_recitautolink')+\"</h2>\";\n        inner.appendChild(header);\n\n        let btn = document.createElement('button');\n        btn.classList.add('close');\n        btn.innerHTML = '<span aria-hidden=\"true\">&times;</span>';\n        btn.setAttribute('data-dismiss', 'modal');\n        btn.onclick = this.destroy.bind(this);\n        header.appendChild(btn);\n\n        let body = document.createElement('div');\n        body.classList.add('modal-body');\n        inner.appendChild(body);\n        body.appendChild(content);\n\n        document.body.appendChild(modal);\n        this.popup = modal;\n\n        this.popup.classList.add('show');\n\n        this.backdrop = document.createElement('div');\n        this.backdrop.classList.add('modal-backdrop', 'fade', 'show');\n        this.backdrop.setAttribute('data-backdrop', 'static');\n        document.body.appendChild(this.backdrop);\n    }\n\n    destroy(){\n        this.popup.classList.remove('show');\n        this.backdrop.classList.remove('show');\n        this.popup.remove();\n        this.backdrop.remove();\n\n        if(this.appReact){\n            this.appReact.unmount();\n        }\n    }\n\n    appReact = null;\n\n    update(){\n       // $(this.popup).modal('handleUpdate');\n    }\n\n    loadUi(){\n        if (window.openRecitAutolinkUI){\n            let classHandler = {\n                get: (v) => this.get(v),\n                close: (v) => this.close(v)\n            }\n            this.appReact = window.openRecitAutolinkUI(classHandler);\n            //this.update();\n        }\n    }\n\n    close(code){\n        this.destroy();\n        if (code){\n            this.editor.execCommand('mceInsertContent', false, code);\n        }\n    }\n}"],"names":["open","editor","js","M","cfg","wwwroot","content","document","createElement","setAttribute","createPopup","getElementById","loadUi","script","onload","this","bind","getElementsByTagName","appendChild","get","k","modal","classList","add","inner2","inner","header","innerHTML","util","get_string","btn","onclick","destroy","body","popup","backdrop","remove","appReact","unmount","update","window","openRecitAutolinkUI","classHandler","v","close","code","execCommand"],"mappings":"oOA6Ge,wIAnFXA,KAAKC,aACIA,OAASA,WAEVC,GADMC,EAAEC,IAAIC,QACF,8DAGVC,QAAUC,SAASC,cAAc,UACrCF,QAAQG,aAAa,KAAM,gCACtBC,YAAYJ,SAEZC,SAASI,eAAe,sBAYpBC,aAZqC,KACtCC,OAASN,SAASC,cAAc,UACpCK,OAAOC,OAASC,KAAKH,OAAOI,KAAKD,MACjCF,OAAOJ,aAAa,MAAOP,IAC3BW,OAAOJ,aAAa,KAAM,iBAC1BI,OAAOJ,aAAa,OAAQ,mBAC5BF,SAASU,qBAAqB,QAAQ,GAAGC,YAAYL,SAU7DM,IAAIC,UACO,wBAAYL,KAAKd,QAG5BS,YAAYJ,aACJe,MAAQd,SAASC,cAAc,OACnCa,MAAMC,UAAUC,IAAI,QAAS,OAAQ,kBACrCF,MAAMZ,aAAa,QAAS,2BAExBe,OAASjB,SAASC,cAAc,OACpCgB,OAAOF,UAAUC,IAAI,gBACrBC,OAAOF,UAAUC,IAAI,YACrBF,MAAMH,YAAYM,YAEdC,MAAQlB,SAASC,cAAc,OACnCiB,MAAMH,UAAUC,IAAI,iBACpBC,OAAON,YAAYO,WAEfC,OAASnB,SAASC,cAAc,OACpCkB,OAAOJ,UAAUC,IAAI,gBACrBG,OAAOC,UAAY,OAAOxB,EAAEyB,KAAKC,WAAW,aAAc,sBAAsB,QAChFJ,MAAMP,YAAYQ,YAEdI,IAAMvB,SAASC,cAAc,UACjCsB,IAAIR,UAAUC,IAAI,SAClBO,IAAIH,UAAY,0CAChBG,IAAIrB,aAAa,eAAgB,SACjCqB,IAAIC,QAAUhB,KAAKiB,QAAQhB,KAAKD,MAChCW,OAAOR,YAAYY,SAEfG,KAAO1B,SAASC,cAAc,OAClCyB,KAAKX,UAAUC,IAAI,cACnBE,MAAMP,YAAYe,MAClBA,KAAKf,YAAYZ,SAEjBC,SAAS0B,KAAKf,YAAYG,YACrBa,MAAQb,WAERa,MAAMZ,UAAUC,IAAI,aAEpBY,SAAW5B,SAASC,cAAc,YAClC2B,SAASb,UAAUC,IAAI,iBAAkB,OAAQ,aACjDY,SAAS1B,aAAa,gBAAiB,UAC5CF,SAAS0B,KAAKf,YAAYH,KAAKoB,UAGnCH,eACSE,MAAMZ,UAAUc,OAAO,aACvBD,SAASb,UAAUc,OAAO,aAC1BF,MAAME,cACND,SAASC,SAEXrB,KAAKsB,eACCA,SAASC,UAMtBC,UAIA3B,YACQ4B,OAAOC,oBAAoB,KACvBC,aAAe,CACfvB,IAAMwB,GAAM5B,KAAKI,IAAIwB,GACrBC,MAAQD,GAAM5B,KAAK6B,MAAMD,SAExBN,SAAWG,OAAOC,oBAAoBC,eAKnDE,MAAMC,WACGb,UACDa,WACK5C,OAAO6C,YAAY,oBAAoB,EAAOD"}